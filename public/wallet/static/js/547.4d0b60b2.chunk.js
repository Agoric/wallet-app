(globalThis.webpackChunk_agoric_wallet_ui=globalThis.webpackChunk_agoric_wallet_ui||[]).push([[547],{5232:()=>{},1164:()=>{},3907:()=>{},1324:()=>{},2298:()=>{},2275:()=>{},5681:()=>{},3308:(e,t,r)=>{"use strict";r.d(t,{F:()=>l,q:()=>c});var n=r(603),a=r(578),s=r(589),o=r(3928);const i=e=>`${e}${Math.random()}`,c=e=>{const t=async e=>(0,s.oV)(e)[Symbol.asyncIterator](),{notifier:r}=(0,s.Gm)(harden({board:(0,n.E)(e).getBoard()})),o=harden({actions:(0,a.cI)("schemaActions",{createPurse:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i("Purse");return(0,n.E)(e).makeEmptyPurse(null===t||void 0===t?void 0:t.issuerPetname,r)},createContact:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i("Contact");return(0,n.E)(e).addContact(r,t)},createIssuer:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i("Issuer");return(0,n.E)(e).addIssuer(r,t,!0)}}),services:t(r),contacts:t((0,n.E)(e).getContactsNotifier()),dapps:t((0,n.E)(e).getDappsNotifier()),issuers:t((0,n.E)(e).getIssuersNotifier()),offers:(c=t((0,n.E)(e).getOffersNotifier()),harden({next:async()=>{const{done:t,value:r}=await(0,n.E)(c).next();return harden({done:t,value:r.map((t=>{let{id:r,...s}=t;return harden({id:r,...s,actions:(0,a.cI)("offerActions",{accept:()=>(0,n.E)(e).acceptOffer(r),decline:()=>(0,n.E)(e).declineOffer(r),cancel:()=>(0,n.E)(e).cancelOffer(r)})})}))})},return:c.return,throw:c.throw})),payments:t((0,n.E)(e).getPaymentsNotifier()),purses:t((0,n.E)(e).getPursesNotifier())});var c;const{notifier:l,updater:u}=(0,s.Gm)(o);return{backendIt:t(l),cancel:e=>{u.fail(e)}}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{throw e};const r={getPursesNotifier:"purses",getContactsNotifier:"contacts",getDappsNotifier:"dapps",getIssuersNotifier:"issuers",getOffersNotifier:"offers",getPaymentsNotifier:"payments"},n=Object.fromEntries(Object.entries(r).map((e=>{let[t,r]=e;return[r,(0,s.Gm)([])]}))),i=async()=>{for await(const{value:t}of(0,o.DC)(e))Object.entries(n).forEach((e=>{let[r,{updater:n}]=e;n.updateState(t[r])}))};i().catch(t);const c=Object.fromEntries(Object.entries(r).map((e=>{let[t,r]=e;const{notifier:a}=n[r];return[t,()=>a]}))),l=(0,a.cI)("follower wallet bridge",{...c});return l}},3928:(e,t,r)=>{"use strict";r.d(t,{DC:()=>E,Hs:()=>S,pu:()=>C,$7:()=>p});var n=r(7017),a=r(578);const s=e=>new Promise((t=>setTimeout(t,e))),o=function(e){return console.warn("retrying after error",e),s(1e3+1e3*Math.random())},i=()=>s(5e3+1e3*Math.random()).then((()=>!0)),c=harden((e=>{const t=(new TextDecoder).decode(e);return harden(JSON.parse(t))})),l="Alleged: ",u=(0,n.cI)("marshal unserializer",{unserialize:(0,a.AU)(void 0,((e,t)=>("string"===typeof t&&t.startsWith(l)&&(t=t.slice(l.length)),(0,n.cI)(`INACCESSIBLE: ${t}`,{})))).unserialize}),d=e=>{for(let t=e.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}},h=async(e,t)=>{const{keepPolling:r=i}=await(0,n.E)(e).getOptions();return(0,n.cI)("polling change follower",{getLatestIterable:()=>(0,n.cI)("polling change follower iterable",{[Symbol.asyncIterator]:()=>{let e;return(0,n.cI)("polling change follower iterator",{next:async()=>{e||(e=r());const n=await e;e=void 0;const a=harden({castingSpec:t,values:[]});return harden({value:a,done:!n})}})}})})},{details:f}=assert,g=(e,t)=>{assert(Array.isArray(e),f`rpcAddrs ${e} must be an array`);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{retryCallback:r=o}=t;d(e);let a=0,s=0;const i=(0,n.cI)("round robin leader",{getOptions:()=>t,retry:async(e,t)=>{if(r)return r(e,t);throw e},watchCasting:e=>h(i,e),mapEndpoints:async t=>new Promise(((r,o)=>{let c=a;const l=async t=>{c=(c+1)%e.length,(0,n.E)(i).retry(t,s).then(u,o),s+=1},u=()=>{Promise.resolve().then((()=>t(e[c]))).then((e=>{r(harden([e])),a=c,s=0}),l)};u()}))});return i}(e.map((e=>(assert.typeof(e,"string",f`rpcAddr ${e} must be a string`),e.includes("://")?e:`http://${e}`))),t)},p=(e,t)=>e.includes("network-config")?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{retryCallback:r=o}=t,n=async(e,t)=>{if(r)return r(e,t);throw e};let a=0;return new Promise(((r,s)=>{const o=async()=>{const r=await fetch(e,{headers:{accept:"application/json"}}),{rpcAddrs:n}=await r.json();return a=0,g(n,t)},i=async e=>{n(e,a).then((()=>o().then(r,i))).catch(s),a+=1};o().then(r,i)}))}(e,t):g([e],t);var y=r(589),m=r(2039),w=r(6578);const v=e=>harden({[Symbol.asyncIterator]:()=>{let t=0;return harden({next:async()=>{const{value:r,updateCount:n}=await e.getUpdateSince(t);return t=n,{value:r,done:void 0===t}}})}}),E=e=>harden({[Symbol.asyncIterator]:()=>{const t=(0,n.E)(e).getLatestIterable(),r=(0,n.E)(t)[Symbol.asyncIterator]();return harden({next:()=>(0,n.E)(r).next()})}}),{details:I}=assert,b=e=>{const t=[];let r=0;for(const n of e)r+=1,1===r?t.push(n):assert.fail(`expected single value, got at least ${r}`);return assert.equal(t.length,1,"expected single value"),t[0]},A=harden({strict:async(e,t,r)=>e().catch(t),none:async(e,t,r)=>r(),optimistic:async(e,t,r)=>{const n=await r();return e().then((e=>{e.length===n.length&&e.every(((e,t)=>e===n[t]))||t(assert.error(I`Alleged value ${n} did not match proof ${e}`))}),t),n}}),C=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{decode:a=c,unserializer:s=u,integrity:o="optimistic",crasher:i=null}=r,{storeName:l,storeSubkey:d,dataPrefixBytes:h=new Uint8Array}=t,f=A[o];assert(f,I`unrecognized follower integrity mode ${o}`);const g=new Map,p=async e=>{if(g.has(e)){const t=g.get(e);return assert(t),t}const t=await m.Tendermint34Client.connect(e),r=w.QueryClient.withExtensions(t);return g.set(e,r),r},C=(t,r)=>async a=>{const s=await(0,n.E)(e).mapEndpoints((async e=>{const s=await p(e);return(0,n.E)(s)[t](r,d,a).then((e=>({result:e,error:null})),(e=>({result:null,error:e})))})),{result:o,error:i}=b(s);if(null!==i)throw i;return assert(o),0===o.length?o:(assert(o.length>=h.length,I`result too short for data prefix ${h}`),assert(h.every(((e,t)=>e===o[t])),I`${o} doesn't start with data prefix ${h}`),o.slice(h.length))},P=C("queryVerified",l),$=C("queryUnverified",`store/${l}/key`);return(0,n.cI)("chain follower",{getLatestIterable:()=>{const{updater:r,notifier:o}=(0,y.Gm)();let c=!1;const l=e=>(c=!0,r.fail(e),!1),u=e=>{l(e),i?(0,n.E)(i).crash("PROOF VERIFICATION FAILURE; crashing follower",e).catch((e=>assert(!1,I`crashing follower failed: ${e}`))):console.error("PROOF VERIFICATION FAILURE; crashing follower",e)};let d=0;const h=t=>{(0,n.E)(e).retry(t,d).catch((e=>{throw l(e),e})),d+=1},g=(e=>{let t=0n,r=0n;return()=>{t+=1n;const a=t;assert(a>r);const s=(0,n.cI)("committer",{isValid:()=>a>r,commit:function(){assert(s.isValid()),r=a,e(...arguments)}});return s}})(r.updateState);let p;const m=async e=>{const t=g(),{values:r,blockHeight:o}=e,i=r.length>0?()=>Promise.resolve(r[r.length-1]):()=>$(o),c=await f((()=>P(o)),u,i);if(0===c.length)return void l(Error("No query results"));if(d=0,!t.isValid())return;if(p&&c.length===p.length&&c.every(((e,t)=>e===p[t])))return;p=c;const h=a(c);if(!s){const e=h;return void t.commit({value:e})}const y=await(0,n.E)(s).unserialize(h);t.isValid()&&t.commit({value:y})},w=(0,n.E)(e).watchCasting(t);return m({values:[],castingSpec:t}).catch(h),(async()=>{for await(const e of E(w)){if(c)return;harden(e),await m(e).catch(h)}})().catch(l),v(o)}})};var P=r(2363);const $=".".charCodeAt(0),N=new Uint8Array([0]),O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vstorage";const r=e?e.split("."):[],n=(0,P.toAscii)(`${r.length}.${e}`);return harden({storeName:t,storeSubkey:n.map((e=>e===$?0:e)),dataPrefixBytes:N})},k=harden({"swingset:":e=>harden({storeName:"swingset",storeSubkey:(0,P.toAscii)(`swingset/data:${e}`)}),"vstore:":O,":":O}),S=e=>{assert.typeof(e,"string");const t=e.match(/^([^:.]*:)(.*)/);assert(t,`spec string ${e} does not match 'PREFIX:PATH' or ':PATH'`);const r=t[1],n=t[2],a=k[r];return assert(a,`Unknown pathKind ${r}`),a(n)}}}]);
//# sourceMappingURL=547.4d0b60b2.chunk.js.map