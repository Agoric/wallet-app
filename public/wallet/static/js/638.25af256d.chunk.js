"use strict";(globalThis.webpackChunk_agoric_wallet_ui=globalThis.webpackChunk_agoric_wallet_ui||[]).push([[638],{4638:(e,t,r)=>{r.r(t),r.d(t,{default:()=>wt});var n=r(64745),a=r(67017),o=r(76059);const s="http://localhost:26657",i=e=>new Promise((t=>setTimeout(t,e))),l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return Math.random()*Math.min(t,e)},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;return l(2**e*t,r)},d=e=>{const t=l(5e3);return console.debug(`jittering ${e} by ${Math.ceil(t)}ms`),i(t)},u=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=c(r);return console.log(`retrying ${e} in ${Math.ceil(n)}ms after attempt #${r}`,t),i(n)},f=()=>i(l(5e3)).then((()=>!0)),h=()=>harden((e=>{try{return harden(JSON.parse(e))}catch(t){throw new Error(`Cannot decode alleged JSON (${t.message}): ${e}`)}})),g=()=>{const e="Alleged: ",t=new Map;return(0,a.cI)("marshal unserializer",{unserialize:(0,o.AU)(void 0,((r,n)=>{if(t.has(r))return t.get(r);"string"===typeof n&&n.startsWith(e)&&(n=n.slice(e.length));const o=(0,a.cI)(`SEVERED: ${n}`,{});return t.set(r,o),o})).unserialize})},p=e=>{for(let t=e.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}},m=async e=>{const{keepPolling:t=f}=await(0,a.E)(e).getOptions(),r=(0,a.cI)("polling change follower iterable",{[Symbol.asyncIterator]:()=>{let r;return(0,a.cI)("polling change follower iterator",{next:async()=>{r||(r=t("polling change follower").then((t=>t?(0,a.E)(e).jitter("polling change follower").then((()=>t)):t)));const n=await r;r=void 0;const o=harden({values:[]});return harden({value:o,done:!n})}})}});return(0,a.cI)("polling change follower",{getLatestIterable:async()=>r,getEachIterable:async()=>r,getReverseIterable:async()=>{throw Error("not implemented for polling change follower")}})},{details:y}=assert,b=(e,t)=>{assert(Array.isArray(e),y`rpcAddrs ${e} must be an array`);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{retryCallback:r=u,jitter:n=d}=t;p(e);let o,s=0,i=0;const l=(0,a.cI)("round robin leader",{getOptions:()=>t,jitter:async e=>n&&n(e),retry:async(e,t,n)=>{if(r)return r(e,t,n);throw t},watchCasting:e=>c,mapEndpoints:async(t,r)=>(t=`${t} (round-robin endpoints)`,new Promise(((c,d)=>{let u=s;const f=r=>{if(!o){const n=i;o=(0,a.E)(l).retry(t,r,n).then((()=>{u=(u+1)%e.length,o=null}))}o.then((()=>n&&n(t))).then(h,d),i+=1},h=()=>{Promise.resolve().then((()=>r(e[u]))).then((e=>{c(harden([e])),s=u,i=0}),f)};h()})))}),c=m(l);return l}(e.map((e=>(assert.typeof(e,"string",y`rpcAddr ${e} must be a string`),e.includes("://")?e:`http://${e}`))),t)},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{retryCallback:r=u,jitter:n=d}=t,a=async(e,t,n)=>{if(r)return r(e,t,n);throw t};let o=0;const s="Network config leader";return new Promise(((r,i)=>{const l=async()=>{const r=await fetch(e,{headers:{accept:"application/json"}}),{rpcAddrs:n}=await r.json();return o=0,b(n,t)},c=async e=>{a(s,e,o).then((()=>n(s))).then((()=>l().then(r,c))).catch(i),o+=1};l().then(r,c)}))},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;return e.includes("network-config")?v(e,t):b([e],t)},E=e=>(0,n.a2)((0,a.E)(e).getSharableNotifierInternals()),I=e=>harden({[Symbol.asyncIterator]:()=>{return t=(0,a.E)(e).getSharableSubscriptionInternals(),(0,a.cI)("SubscriptionIterator",{next:async()=>{const e=a.E.get(t).head;return t=a.E.get(t).tail,e}});var t}}),S=(e,t)=>async function*(){for await(const r of e)yield t(r)}(),x=(e,t)=>(0,a.cI)("iterateEach iterable",{[Symbol.asyncIterator]:()=>{const r=(0,a.E)(e).getEachIterable(t),n=(0,a.E)(r)[Symbol.asyncIterator]();return(0,a.cI)("iterateEach iterator",{next:()=>(0,a.E)(n).next()})}});var k=r(2039),j=r.t(k,2),$=r(16578),C=r.t($,2),N=r(82363),A=r.t(N,2);const{toAscii:M}=A,P=".".charCodeAt(0),Z=new Uint8Array([0]),O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vstorage";const r=e?e.split("."):[],n=M(`${r.length}.${e}`);return harden({storeName:t,storeSubkey:n.map((e=>e===P?0:e)),dataPrefixBytes:Z})},W=harden({"swingset:":e=>harden({storeName:"swingset",storeSubkey:M(`swingset/data:${e}`)}),"vstore:":O,":":O}),H=new TextEncoder,z=e=>{const{storeName:t,storeSubkey:r,dataPrefixBytes:n,subscription:a,notifier:o}=e;if(a||o)return harden({subscription:a,notifier:o});let s=r;"string"===typeof r&&(s=H.encode(r));let i=n;return"string"===typeof n&&(i=H.encode(n)),harden({storeName:t,storeSubkey:s,dataPrefixBytes:i})},B=async e=>{const t=await e;if("string"===typeof t)return(e=>{assert.typeof(e,"string");const t=e.match(/^([^:.]*:)(.*)/);assert(t,`spec string ${e} does not match 'PREFIX:PATH' or ':PATH'`);const r=t[1],n=t[2],a=W[r];return assert(a,`Unknown pathKind ${r}`),a(n)})(t);const{storeName:r,subscription:n,notifier:o}=t;return r||n||o?z(t):(0,a.mY)(t)?(async e=>{const t=await(0,a.E)(e).getStoreKey();return z(t)})(t):void assert.fail(`CastingSpec ${t} is not a string, object, or ref`)},{QueryClient:T}=C,{Tendermint34Client:R}=j,{details:L,quote:V}=assert,D=new TextDecoder,K=e=>e&&"object"===typeof e&&Array.isArray(e.values)&&"string"===typeof e.blockHeight&&/^0$|^[1-9][0-9]*$/.test(e.blockHeight),U=(e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0},q=new Uint8Array,_=e=>{const t=[];let r=0;for(const n of e)r+=1,1===r?t.push(n):assert.fail(`expected single value, got at least ${r}`);return assert.equal(t.length,1,"expected single value"),t[0]},F=["strict","none","optimistic"],G=async(e,t,r)=>{const n=await B(e),{storeName:o}=n;return o?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{decode:n=h(),unserializer:o=g(),proof:s="optimistic",crasher:i=null}=r,l=e=>{throw i&&(0,a.E)(i).crash("PROOF VERIFICATION FAILURE; crashing follower",e).catch((e=>assert.fail(L`crashing follower failed: ${e}`))),e};assert(F.includes(s),L`unrecognized follower proof mode ${s}`);const c="CosmJS follower",d=B(e),u="function"===typeof t?t():t,f=new Map,p=e=>{let t=f.get(e);return t||(t=R.connect(e),f.set(e,t)),t},m=async()=>{const e=await(0,a.E)(u).mapEndpoints(c,(async e=>{const t=await p(e),r=await t.abciInfo(),{lastBlockHeight:n}=r;return assert.typeof(n,"number"),n}));return _(e)},y=new Map,b=async e=>{if(y.has(e)){const t=y.get(e);return assert(t),t}const t=await p(e),r=T.withExtensions(t);return y.set(e,r),r},v=async e=>{const{storeName:t,storeSubkey:r,dataPrefixBytes:n=q}=await d;assert.typeof(t,"string",L`storeName must be a string, got ${t}`),assert(r,L`storeSubkey must be a Uint8Array, got ${r}`);const o=await(0,a.E)(u).mapEndpoints(c,(async n=>e(n,t,r).then((e=>({result:e,error:null})),(e=>({result:null,error:e}))))),{result:s,error:i}=_(o);if(null!==i)throw i;return assert(s),0===s.length?s:(assert(s.length>=n.length,L`result too short for data prefix ${n}`),assert(U(s.subarray(0,n.length),n),L`${s} doesn't start with data prefix ${n}`),s.slice(n.length))},E=async e=>v((async(t,r,n)=>{const o=await b(t);return(0,a.E)(o).queryVerified(r,n,e)})),I=async e=>v((async(t,r,n)=>{const a=await p(t),o=await a.abciQuery({path:`store/${r}/key`,data:n,height:e,prove:!1});if(0!==o.code)throw new Error(`Tendermint ABCI query failed: ${o.log}`);const{value:s}=o;return s})),S=async e=>{if("strict"===s)return E(e).catch(l);if("none"===s)return I(e);if("optimistic"===s){const t=await I(e);return E(e).then((e=>{U(e,t)||l(assert.error(L`Alleged value ${t} did not match proof ${e}`))}),l),t}assert.fail(L`Unrecognized proof option ${V(s)}, must be one of strict, none, or optimistic`)},x=async e=>{assert.typeof(e,"number");for(let r=0;;r+=1)try{return await S(e)}catch(t){await(0,a.E)(u).retry(c,t,r);continue}},k=(e,t)=>{const r=D.decode(t);try{const e=JSON.parse(r);if(K(e))return harden({blockHeight:Number(e.blockHeight),values:e.values.map(n)})}catch{}return harden({blockHeight:e,values:[n(r)]})},j=async(e,t,r)=>({value:await(o?(0,a.E)(o).unserialize(e):e),blockHeight:t,currentBlockHeight:r});function*$(e,t){for(const r of e.values)yield j(r,e.blockHeight,t)}function*C(e,t){for(let r=e.values.length-1;r>=0;r-=1)yield j(e.values[r],e.blockHeight,t)}function*N(e,t){const{values:r}=e;if(r.length>0){const n=r[r.length-1];yield j(n,e.blockHeight,t)}}async function*A(){let e,t;for(;;){const r=await m();if(r===e){await(0,a.E)(u).jitter(c);continue}const n=await x(r);if(0===n.length){await(0,a.E)(u).jitter(c);continue}const o=k(r,n);e=r,void 0!==t&&U(t,n)||(yield*N(o,r),t=n)}}async function*M(e){let t;for(assert.typeof(e,"number");;){if(t=await x(e),0!==t.length){const r=k(e,t);yield*$(r,e);break}await(0,a.E)(u).jitter(c),e=await m()}for(;;){const r=await m();if(r<=e){await(0,a.E)(u).jitter(c);continue}let n=r,o=await x(n);if(0===o.length){await(0,a.E)(u).jitter(c);continue}let s=k(n,o);const i=o,l=[];for(;n>e;){if(s.blockHeight>n){const{storeName:e,storeSubkey:t}=await d;throw new Error(`Corrupt storage cell for ${e} under key ${t} at block-height ${n} claims to being published at a later block height ${s.blockHeight}`)}const t=s.blockHeight-1;if(t<=e)break;const r=await x(t);if(0===r.length)break;const a=k(t,r);U(r,o)||l.push(s),o=r,s=a,n=t}for(U(o,t)||l.push(s);;){const e=l.pop();if(void 0===e)break;yield*$(e,r)}e=r,t=i}}async function*P(e){let t;for(;e>0;){if(t=await x(e),0===t.length)return;const r=k(e,t);yield*C(r,e),e=r.blockHeight-1}}return(0,a.cI)("chain follower",{getLatestIterable:async()=>A(),async getEachIterable(){let{height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0===e&&(e=await m()),M(e)},async getReverseIterable(){let{height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0===e&&(e=await m()),P(e)}})}(n,t,r):(e=>{const t=e=>harden({value:e,blockHeight:NaN,currentBlockHeight:NaN});return(0,a.cI)("subscription/notifier follower",{getLatestIterable:async()=>{const{notifier:r,subscription:n}=await e;let a;return r?a=E(r):(assert(n),a=I(n)),S(a,t)},getEachIterable:async()=>{const{notifier:r,subscription:n}=await e;let a;return n?a=I(n):(assert(r),a=E(r)),S(a,t)},getReverseIterable:async()=>{throw Error("reverse iteration not implemented for subscription follower")}})})(n)},J="no smart wallet",Q=async e=>{const t=(0,a.E)(e).getReverseIterable(),r=await(0,a.E)(t)[Symbol.asyncIterator](),n=await r.next();n.done&&!n.value&&assert.fail(J)};var X=r(33901),Y=r(54656);const{details:ee,quote:te}=assert,re=e=>"string"===typeof e&&!!e.match(/^board[^:]/),ne=(e,t,r)=>`${t}:${`${r}`}`,ae=(e,t)=>Object.keys(e).find(t),oe=(e,t)=>{const r=ae(e,(e=>t.startsWith(`${e}:`)));return{kind:r,id:r?Number(t.slice(r.length+1)):NaN}},se=(e,t,r)=>{e.bySlot.init(t,r),e.byVal.init(r,t)},ie=e=>{const t=`SEVERED: ${e.replace(/^Alleged: /,"")}`;return(0,o.cI)(t,{})},le=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie;const t={purse:{bySlot:(0,X.WS)(),byVal:(0,X.WS)()},payment:{bySlot:(0,X.WS)(),byVal:(0,X.WS)()},unknown:{bySlot:(0,X.WS)(),byVal:(0,X.WS)()}},r={bySlot:(0,X.WS)(),byVal:(0,X.WS)()},n=(t,r,n)=>{if(t.bySlot.has(r))return t.bySlot.get(r);const a=e(n);return se(t,r,a),a},a={fromBoard:(e,t)=>(assert(re(e),ee`bad board slot ${te(e)}`),n(r,e,t)),fromMyWallet:(r,o)=>{if(!r)return e(`${r}`);const{kind:s,id:i}=oe(t,r);return s?n(t[s],i,o):a.fromBoard(r,o)}},s={fromBoard:e=>r.byVal.get(e),fromMyWallet:e=>{const r=ae(t,(r=>t[r].byVal.has(e)));assert(r,ee`cannot serialize unregistered ${e}`);const n=t[r].byVal.get(e);return ne(0,r,n)}},i={fromBoard:(0,o.AU)(s.fromBoard,a.fromBoard,{marshalName:"fromBoard"}),fromMyWallet:(0,o.AU)(s.fromMyWallet,a.fromMyWallet,{marshalName:"fromMyWallet"})};return harden({initBoardId:(e,t)=>{se(r,e,t)},ensureBoardId:(e,t)=>{r.byVal.has(t)?assert.equal(r.byVal.get(t),e):se(r,e,t)},fromMyWallet:(0,o.cI)("wallet marshaller",{...i.fromMyWallet}),fromBoard:(0,o.cI)("board marshaller",{...i.fromBoard})})};var ce=r(66017),de=r(20011),ue=r(53617),fe=(r(63090),r(85466)),he=r(46153),ge=r(84146),pe=r(4014),me=r(24046),ye=r(43469),be=r(11532),ve=r(54394),we=r(29003);function Ee(e){return(0,ve.Z)("MuiAlert",e)}const Ie=(0,we.Z)("MuiAlert",["root","action","icon","message","filled","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]);var Se=r(94697),xe=r(3952),ke=r(5030);const je=(0,xe.Z)((0,ke.jsx)("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),$e=(0,xe.Z)((0,ke.jsx)("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),Ce=(0,xe.Z)((0,ke.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),Ne=(0,xe.Z)((0,ke.jsx)("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined");var Ae,Me=r(8256);const Pe=["action","children","className","closeText","color","icon","iconMapping","onClose","role","severity","variant"],Ze=(0,pe.ZP)(be.Z,{name:"MuiAlert",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`${r.variant}${(0,ye.Z)(r.color||r.severity)}`]]}})((e=>{let{theme:t,ownerState:r}=e;const n="light"===t.palette.mode?ge._j:ge.$n,a="light"===t.palette.mode?ge.$n:ge._j,o=r.color||r.severity;return(0,de.Z)({},t.typography.body2,{borderRadius:t.shape.borderRadius,backgroundColor:"transparent",display:"flex",padding:"6px 16px"},o&&"standard"===r.variant&&{color:n(t.palette[o].light,.6),backgroundColor:a(t.palette[o].light,.9),[`& .${Ie.icon}`]:{color:"dark"===t.palette.mode?t.palette[o].main:t.palette[o].light}},o&&"outlined"===r.variant&&{color:n(t.palette[o].light,.6),border:`1px solid ${t.palette[o].light}`,[`& .${Ie.icon}`]:{color:"dark"===t.palette.mode?t.palette[o].main:t.palette[o].light}},o&&"filled"===r.variant&&{color:"#fff",fontWeight:t.typography.fontWeightMedium,backgroundColor:"dark"===t.palette.mode?t.palette[o].dark:t.palette[o].main})})),Oe=(0,pe.ZP)("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(e,t)=>t.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),We=(0,pe.ZP)("div",{name:"MuiAlert",slot:"Message",overridesResolver:(e,t)=>t.message})({padding:"8px 0"}),He=(0,pe.ZP)("div",{name:"MuiAlert",slot:"Action",overridesResolver:(e,t)=>t.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),ze={success:(0,ke.jsx)(je,{fontSize:"inherit"}),warning:(0,ke.jsx)($e,{fontSize:"inherit"}),error:(0,ke.jsx)(Ce,{fontSize:"inherit"}),info:(0,ke.jsx)(Ne,{fontSize:"inherit"})},Be=ue.forwardRef((function(e,t){const r=(0,me.Z)({props:e,name:"MuiAlert"}),{action:n,children:a,className:o,closeText:s="Close",color:i,icon:l,iconMapping:c=ze,onClose:d,role:u="alert",severity:f="success",variant:h="standard"}=r,g=(0,ce.Z)(r,Pe),p=(0,de.Z)({},r,{color:i,severity:f,variant:h}),m=(e=>{const{variant:t,color:r,severity:n,classes:a}=e,o={root:["root",`${t}${(0,ye.Z)(r||n)}`,`${t}`],icon:["icon"],message:["message"],action:["action"]};return(0,he.Z)(o,Ee,a)})(p);return(0,ke.jsxs)(Ze,(0,de.Z)({role:u,square:!0,elevation:0,ownerState:p,className:(0,fe.Z)(m.root,o),ref:t},g,{children:[!1!==l?(0,ke.jsx)(Oe,{ownerState:p,className:m.icon,children:l||c[f]||ze[f]}):null,(0,ke.jsx)(We,{ownerState:p,className:m.message,children:a}),null!=n?(0,ke.jsx)(He,{className:m.action,children:n}):null,null==n&&d?(0,ke.jsx)(He,{ownerState:p,className:m.action,children:(0,ke.jsx)(Se.Z,{size:"small","aria-label":s,title:s,color:"inherit",onClick:d,children:Ae||(Ae=(0,ke.jsx)(Me.Z,{fontSize:"small"}))})}):null]}))}));var Te=r(33276),Re=r(17141),Le=r(24935),Ve=r(96590),De=r(15155);const Ke=e=>{var t;let{chainId:r,address:n}=e;return null!==(t=(0,De.Kl)([De.qj,r,n]))&&void 0!==t?t:[]},Ue=e=>{let{smartWalletKey:t,origin:r}=e;return Ke(t).find((e=>e.origin===r))},qe=e=>{const{notifier:t,updater:r}=(0,n.Gm)(),a=t=>((e,t)=>{let{chainId:r,address:n}=e;const{origin:a,isEnabled:o,petname:s}=t,i=Ke(r);(0,De.Ad)([De.qj,r,n],[...i.filter((e=>e.origin!==a)),{origin:a,isEnabled:o,petname:s}])})(e,t),o=(t,r)=>{(e=>{let{smartWalletKey:{chainId:t,address:r},origin:n}=e;const a=Ke({chainId:t,address:r});(0,De.Ad)([De.qj,t,r],a.filter((e=>e.origin!==n)))})({smartWalletKey:e,origin:t}),r()},s=(t,r,n)=>{const o=Ue({smartWalletKey:e,origin:t});assert(o,`Tried to set petname on undefined dapp ${t}`),a({...o,petname:r}),n()},i=(t,r)=>{const n=Ue({smartWalletKey:e,origin:t});assert(n,`Tried to enable undefined dapp ${t}`),a({...n,isEnabled:!0}),r()},l=()=>{const t=new Map;Ke(e).forEach((e=>{t.set(e.origin,{...e,actions:{enable:()=>i(e.origin,l),setPetname:t=>s(e.origin,t,l),delete:()=>o(e.origin,l)}})})),(e=>{r.updateState([...e.values()])})(t)};return((e,t)=>{let{chainId:r,address:n}=e;(0,De.H9)([De.qj,r,n],(e=>t(null!==e&&void 0!==e?e:[])))})(e,l),l(),{notifier:t,addDapp:a,setDappPetname:s,deleteDapp:o,enableDapp:i}},_e=e=>{const t=new Map,{notifier:r,updater:a}=(0,n.Gm)(),o=()=>a.updateState([...t.values()]),s=e=>{assert(t.has(e),`Tried to delete undefined issuer suggestion ${e}`),t.delete(e),o()};return{notifier:r,addSuggestion:(r,n)=>{t.set(n,{boardId:n,petname:r,actions:{delete:()=>s(n),accept:async t=>{const r=JSON.stringify({type:"suggestIssuer",data:{boardId:n,petname:t}});try{await e(r),s(n)}catch(a){console.error("Sign spend action failed",r)}}}}),o()}}},Fe={proposed:"proposed",accepted:"accept",rejected:"rejected",pending:"pending",declined:"decline"},Ge=e=>{var t;let{chainId:r,address:n}=e;return null!==(t=(0,De.Kl)([De.jo,r,n]))&&void 0!==t?t:[]},Je=(e,t)=>{var r;let{chainId:n,address:a}=e;const o=null!==(r=Ge({chainId:n,address:a}))&&void 0!==r?r:[];(0,De.Ad)([De.jo,n,a],o.filter((e=>e.id!==t)))},Qe=(e,t,r,a)=>{const o=new Map,{notifier:s,updater:i}=(0,n.Gm)(),l=()=>i.updateState([...o.values()]),c=async(e,t)=>{const{id:r,instanceHandle:n,publicInvitationMaker:o,proposalTemplate:{give:s,want:i}}=t,l=t=>Object.fromEntries(Object.entries(t).map((t=>{let[r,{pursePetname:n,value:a}]=t;const o=e.get(n);return o?[r,{brand:o,value:BigInt(a)}]:[]}))),c=await(0,Y.E)(a).unserialize(n),{slots:[d]}=await(0,Y.E)(a).serialize(c),u={id:r,invitationSpec:{source:"contract",instance:c,publicInvitationMaker:o},proposal:{give:l(s),want:l(i)}},f=await(0,Y.E)(a).serialize(harden({method:"executeOffer",offer:u}));return{...t,instancePetname:`instance@${d}`,spendAction:JSON.stringify(f)}},d=t=>{o.set(t.id,t),((e,t)=>{var r;let{chainId:n,address:a}=e;const o=null!==(r=Ge({chainId:n,address:a}))&&void 0!==r?r:[];(0,De.Ad)([De.jo,n,a],[...o.filter((e=>e.id!==t.id)),t])})(e,t),l()};return{start:t=>{const a=Ge(e);Promise.all(a.map((async r=>{r.status===Fe.declined&&Je(e,r.id);const n=await c(t,r);o.set(n.id,{...n})}))).then((()=>l())),(async()=>{for await(const t of(0,n.oV)(r)){console.log("offerStatus",{status:t,offers:o});const r=o.get(null===t||void 0===t?void 0:t.id);r?(void 0!==t.error?(o.set(t.id,{...r,id:t.id,status:Fe.rejected,error:`${t.error}`}),Je(e,t.id)):void 0!==t.numWantsSatisfied?(o.set(t.id,{...r,id:t.id,status:Fe.accepted}),Je(e,t.id)):void 0===t.numWantsSatisfied&&(o.set(t.id,{...r,id:t.id,status:Fe.pending}),d({...r,status:Fe.pending})),l()):console.warn("Update for unknown offer, doing nothing.")}})(),((e,t)=>{let{chainId:r,address:n}=e;(0,De.H9)([De.jo,r,n],(e=>t(null!==e&&void 0!==e?e:[])))})(e,(e=>{Promise.all(e.map((e=>c(t,e).then((e=>{const t=o.get(e.id),r=t&&[Fe.rejected,Fe.accepted].includes(t.status)?t.status:e.status;o.set(e.id,{...e,status:r})}))))).then((()=>l()))}))},offers:o,notifier:s,addOffer:d,acceptOffer:async e=>{const r=o.get(e);return assert(r,`Tried to accept undefined offer ${e}`),t(r.spendAction)},cancelOffer:e=>{console.log("TODO: cancel offer")},declineOffer:e=>{const t=o.get(e);assert(t,`Tried to decline undefined offer ${e}`),d({...t,status:Fe.declined}),l()}}},Xe=e=>`${e}${Math.random()}`;var Ye=r(26758),et=r(85867),tt=r(18),rt=r(57152),nt=r(89166);function at(e){return(0,ve.Z)("MuiDialogContentText",e)}(0,we.Z)("MuiDialogContentText",["root"]);const ot=["children"],st=(0,pe.ZP)(nt.Z,{shouldForwardProp:e=>(0,pe.FO)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),it=ue.forwardRef((function(e,t){const r=(0,me.Z)({props:e,name:"MuiDialogContentText"}),n=(0,ce.Z)(r,ot),a=(e=>{const{classes:t}=e,r=(0,he.Z)({root:["root"]},at,t);return(0,de.Z)({},t,r)})(n);return(0,ke.jsx)(st,(0,de.Z)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:n},r,{classes:a}))}));var lt=r(88174),ct=r(36794),dt=r(6246),ut=r(79419);const ft=0,ht=1,gt=2,pt="Cannot sign a transaction in read only mode, connect to keplr.",mt=100n*1000000n,yt=(e,t)=>{const[r,n]=(0,ue.useState)(null);return(0,ue.useEffect)((()=>{let r=!1;return(async()=>{const o=await G(":published.provisionPool.metrics",t,{unserializer:e});for await(const{value:e}of(e=>(0,a.cI)("iterateLatest iterable",{[Symbol.asyncIterator]:()=>{const t=(0,a.E)(e).getLatestIterable(),r=(0,a.E)(t)[Symbol.asyncIterator]();return(0,a.cI)("iterateLatest iterator",{next:()=>(0,a.E)(r).next()})}}))(o)){if(r)break;console.log("provisionPoolData",e),n(e)}})().catch((e=>console.error("useProvisionPoolMetrics fetchData error",e))),()=>{r=!0}}),[e,t]),r},bt=(0,Re.LW)((e=>{let{onClose:t,open:r,address:n,href:a,keplrConnection:o,unserializer:s,leader:i}=e;const[l,c]=(0,ue.useState)(ft),[d,u]=(0,ue.useState)(null),f=yt(s,i),h=e=>(0,ke.jsxs)(dt.Z,{children:[(0,ke.jsx)(dt.Z,{sx:{margin:"auto",display:"flex",flexDirection:"row",justifyContent:"center"},children:(0,ke.jsx)(Ye.Z,{})}),(0,ke.jsx)(it,{sx:{pt:2},children:e})]}),g=(0,ue.useMemo)((()=>{switch(l){case ft:return(0,ke.jsxs)("div",{children:[(0,ke.jsxs)(it,{children:[(0,ke.jsx)("b",{children:"Network Config"}),":"," ",(0,ke.jsx)(ut.Z,{href:a,underline:"none",color:"rgb(0, 176, 255)",children:a})]}),(0,ke.jsxs)(it,{sx:{pt:2},children:[(0,ke.jsx)("b",{children:"Wallet Address:"})," ",n]}),(0,ke.jsxs)(it,{sx:{pt:2},children:["There is no smart wallet provisioned for this address yet. A fee of ",(0,ke.jsx)("b",{children:"10 BLD"})," is required to create one."]})]});case ht:return h("Please approve the transaction in Keplr.");case gt:return h("Awaiting smart wallet creation...");default:return(0,ke.jsx)(ke.Fragment,{})}}),[l,a,n]),p=null!==f&&(e=>e&&Le.iU.subtract(e.totalMintedConverted,e.totalMintedProvided).value<mt)(f);return(0,ke.jsxs)(et.Z,{open:r,children:[(0,ke.jsxs)(tt.Z,{children:[l===ft?"Create a":"Creating"," Smart Wallet"]}),(0,ke.jsxs)(rt.Z,{children:[g,p&&(0,ke.jsx)(it,{sx:{pt:2},color:"error",children:"The pool of funds to provision smart wallets is too small at this time."}),d&&(0,ke.jsx)(it,{sx:{pt:2},color:"error",children:d})]}),l===ft&&(0,ke.jsxs)(lt.Z,{children:[(0,ke.jsx)(ct.Z,{color:"inherit",onClick:t,children:"Change Connection"}),(0,ke.jsx)(ct.Z,{disabled:!f||p,onClick:()=>{const{signers:{interactiveSigner:e}}=o;e?(async e=>{u(null),c(ht);try{await e.submitProvision()}catch(t){return c(ft),void u(t.message)}c(gt)})(e):u(pt)},children:"Create"})]})]})}),(e=>({keplrConnection:e.keplrConnection}))),vt=ue.forwardRef((function(e,t){let{children:r,...n}=e;return(0,ke.jsx)(Be,{elevation:6,ref:t,variant:"filled",...n,children:r})})),wt=(0,Re.LW)((e=>{var t,r;let{connectionConfig:a,setConnectionStatus:s,setBackend:i,setBackendErrorHandler:l,keplrConnection:c}=e;const[d,u]=(0,ue.useState)([]),[f,h]=(0,ue.useState)(!1),g=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";t&&(console.error(`${e}:`,t),e+=`: ${t.message}`),"error"===r&&s(Re.QK.Error),u((t=>[...t,{severity:r,message:e}]))},{href:p}=a,m=(()=>{if(c)return c.address})(),y=e=>{e.message===J?(h(!0),s(Re.QK.Error)):(i(null),g("Error in wallet backend",e))},[b,v]=(0,ue.useMemo)((()=>[le(),w(p)]),[a,c]);return(0,ue.useEffect)((()=>{if(!a||!c)return;let e;return(async()=>{const t=e=>G(`:published.${e}`,v,{unserializer:b.fromMyWallet}),r=function(e,t,r,a,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e=>{throw e},l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};const c={getPursesNotifier:"purses",getContactsNotifier:"contacts",getIssuersNotifier:"issuers",getOffersNotifier:"offers",getPaymentsNotifier:"payments"},d=Object.fromEntries(Object.entries(c).map((e=>{let[t,r]=e;return[r,(0,n.Gm)(null)]}))),u=new Map,f=new Map,h=()=>{const e=[];for(const[t,r]of u.entries())r.currentAmount&&r.brandPetname&&(assert(r.pursePetname,"missing purse.pursePetname"),f.set(r.pursePetname,t),e.push(r));d.purses.updater.updateState(harden(e))},g=async e=>{const{signers:{interactiveSigner:t}}=s;if(!t)throw new Error("Cannot sign a transaction in read only mode, connect to keplr.");return t.submitSpendAction(e)},p=(0,Ve.xh)(c,(e=>()=>d[e].notifier)),m=p.getOffersNotifier(),y=Qe(e,g,m,t),b=async()=>{await Q(r);const e=(await(0,Y.E)(r).getLatestIterable())[Symbol.asyncIterator](),t=await e.next();l&&(l(),Object.values(d).forEach((e=>{let{updater:t}=e;return t.updateState([])})),l=void 0);const n=t.value,a=n.value;console.log("wallet current",a);for(const r of a.purses){console.debug("registering purse",r);const e=a.brands.find((e=>r.brand===e.brand));assert(e,`missing descriptor for brand ${r.brand}`);const t={brand:r.brand,currentAmount:r.balance,brandPetname:e.petname,pursePetname:e.petname,displayInfo:e.displayInfo};u.set(r.brand,t)}return console.debug("brandToPurse map",u),h(),y.start(f),n.blockHeight},v=async e=>{for await(const{value:t}of x(a,{height:e})){const e=t;switch(e.updated){case"brand":{const{descriptor:{brand:t,petname:r,displayInfo:n}}=e,a=u.get(t),o={brand:t,brandPetname:r,pursePetname:r,displayInfo:n,currentAmount:(null===a||void 0===a?void 0:a.currentAmount)||Le.iU.makeEmpty(t)};u.set(t,o),h();break}case"balance":{const{currentAmount:t}=e,r={...u.get(t.brand),currentAmount:t,value:t.value};u.set(t.brand,r),h();break}case"offerStatus":{const{status:t}=e;d.offers.updater.updateState(t);break}default:throw Error(`Unknown updateRecord ${e.updated}`)}}},w=()=>b().then(v),E=()=>{w().catch((e=>{e.message===J?setTimeout(E,5e3):i(e)}))};w().catch((e=>{i(e),e.message===J&&setTimeout(E,5e3)}));const I=(e,t)=>{console.log("make empty purse")},S=(e,t)=>{console.log("add contact")},k=(e,t,r)=>{console.log("add issuer")},j=_e(g),$=qe(e),{acceptOffer:C,declineOffer:N,cancelOffer:A}=y,{getContactsNotifier:M,getIssuersNotifier:P,getPaymentsNotifier:Z,getPursesNotifier:O}=p;return(0,o.cI)("follower wallet bridge",{getDappsNotifier:()=>$.notifier,getOffersNotifier:()=>y.notifier,getIssuerSuggestionsNotifier:()=>j.notifier,getIssuersNotifier:P,getContactsNotifier:M,getPaymentsNotifier:Z,getPursesNotifier:O,acceptOffer:C,declineOffer:N,cancelOffer:A,makeEmptyPurse:I,addContact:S,addIssuer:k})}({chainId:c.chainId,address:m},b.fromBoard,t(`wallet.${m}.current`),t(`wallet.${m}`),c,y,(()=>{s(Re.QK.Connected),h(!1)})),{backendIt:a,cancel:d}=(e=>{const t=async e=>(0,n.oV)(e)[Symbol.asyncIterator](),{notifier:r}=(0,n.Gm)(),a=harden({actions:(0,o.cI)("schemaActions",{createPurse:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe("Purse");return(0,Y.E)(e).makeEmptyPurse(null===t||void 0===t?void 0:t.issuerPetname,r)},createContact:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe("Contact");return(0,Y.E)(e).addContact(r,t)},createIssuer:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe("Issuer");return(0,Y.E)(e).addIssuer(r,t,!0)}}),services:t(r),contacts:t((0,Y.E)(e).getContactsNotifier()),dapps:t((0,Y.E)(e).getDappsNotifier()),issuers:t((0,Y.E)(e).getIssuersNotifier()),offers:(s=t((0,Y.E)(e).getOffersNotifier()),harden({next:async()=>{const{done:t,value:r}=await(0,Y.E)(s).next();return harden({done:t,value:r&&r.map((t=>{let{id:r,...n}=t;return harden({id:r,...n,actions:{accept:()=>(0,Y.E)(e).acceptOffer(r),decline:()=>(0,Y.E)(e).declineOffer(r),cancel:()=>(0,Y.E)(e).cancelOffer(r)}})}))})},return:s.return,throw:s.throw})),payments:t((0,Y.E)(e).getPaymentsNotifier()),purses:t((0,Y.E)(e).getPursesNotifier()),issuerSuggestions:t((0,Y.E)(e).getIssuerSuggestionsNotifier())});var s;const{notifier:i,updater:l}=(0,n.Gm)(a);return{backendIt:t(i),cancel:e=>{l.fail(e)}}})(r);return e=d,l((()=>y)),(0,n.uO)(a,{updateState:t=>{e&&i(t)},fail:t=>{e&&y(t)},finish:t=>{e&&i(t)}})})().catch((e=>g("Cannot read Smart Wallet casting",e))),()=>{e&&e(),e=void 0}}),[a,c]),(0,ke.jsxs)("div",{children:[(0,ke.jsx)(Te.Z,{open:d.length>0,children:(0,ke.jsx)(vt,{onClose:(e,t)=>{"clickaway"!==t&&u((e=>e.slice(1)))},severity:null===(t=d[0])||void 0===t?void 0:t.severity,sx:{width:"100%"},children:null===(r=d[0])||void 0===r?void 0:r.message})}),(0,ke.jsx)(bt,{open:f,onClose:()=>{h(!1)},address:m,href:p,unserializer:b.fromBoard,leader:v})]})}),(e=>({connectionConfig:e.connectionConfig,setConnectionStatus:e.setConnectionStatus,setBackend:e.setBackend,setBackendErrorHandler:e.setBackendErrorHandler,keplrConnection:e.keplrConnection})))}}]);
//# sourceMappingURL=638.25af256d.chunk.js.map